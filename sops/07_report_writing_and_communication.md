# SOP-007: Report Writing & Communication

**Version:** 1.0
**Last Updated:** 2026-02-09
**Owner:** FE-Analyst Research Team
**Status:** Active

---

## 1. Purpose

The analysis is only valuable if communicated clearly. This SOP documents how expert financial analysts structure, write, and present investment research produced by the FE-Analyst platform. Reports must be actionable, rigorous, and accessible to both technical and non-technical audiences.

This document governs every report artifact generated by the platform, whether produced by an AI agent, a script, or a human analyst using the platform tools. It serves as the single source of truth for report quality, structure, formatting, and communication standards.

---

## 2. Scope

This SOP applies to all output generated by:

- `src/reports/generator.py` (ReportGenerator class)
- `scripts/ai_deep_dive.py` (Full Investment Memo)
- `scripts/ai_universe_scanner.py` (Universe Scanner Report)
- `scripts/ai_comparisons.py` (Comparative Analysis)
- `main.py analyze` (Quick Analysis with composite score)
- `main.py compare` (Quick Comparison)
- Any ad-hoc analysis notebooks in `notebooks/`
- AI agent-generated commentary referencing platform data

---

## 3. Report Types and When to Use Each

### 3.1 Full Investment Memo (`ai_deep_dive.py` output)

| Attribute | Specification |
|-----------|--------------|
| **When** | Deep analysis of a single company |
| **Audience** | Investment decision-makers, portfolio managers |
| **Length** | Comprehensive -- all sections (typically 800-2000 lines of markdown) |
| **Output** | `reports/output/deep_dive_{TICKER}_{YYYYMMDD_HHMMSS}.md` |
| **Key Requirement** | Must include actionable recommendation with supporting evidence |
| **Data Sources Used** | yfinance (profile, financials, price), FundamentalsClient (ratios), TechnicalAnalyzer (signals, support/resistance), RiskAnalyzer (volatility, beta, VaR), ValuationAnalyzer (DCF), NewsSentimentClient (FinBERT), peer comparison |

**Use this when:**
- A company enters or exits the AI moat universe
- Quarterly earnings materially change the investment thesis
- A company is being considered for a new position
- Management requests a full write-up on a specific name

**Do NOT use this when:**
- You need a quick screening across many names (use Universe Scanner)
- You are comparing two or more companies head-to-head (use Comparative Analysis)

### 3.2 Universe Scanner Report (`ai_universe_scanner.py` output)

| Attribute | Specification |
|-----------|--------------|
| **When** | Screening across all 60+ AI supply chain companies |
| **Audience** | Portfolio managers, research teams |
| **Length** | Summary tables with drill-down by category |
| **Output** | `reports/output/ai_moat_scan_{YYYYMMDD_HHMMSS}.md` + `.csv` |
| **Key Requirement** | Ranked comparison, easy to scan, sortable data |
| **Data Sources Used** | yfinance (live prices, info), configs/ai_moat_universe.yaml (moat scores) |

**Use this when:**
- Weekly or monthly portfolio review across the entire universe
- Looking for new opportunities across categories
- Identifying relative value (low P/E + high moat score)
- Tracking performance leaders and laggards

**The report must include:**
- Total company count and category count at the top
- Top 15 companies by moat score
- Category-level breakdowns with all companies
- Best 1-year performers table
- Value + Moat opportunity filter (P/E < 20 and Moat > 70)

### 3.3 Comparative Analysis (`ai_comparisons.py` output)

| Attribute | Specification |
|-----------|--------------|
| **When** | Evaluating peers within a category or custom group |
| **Audience** | Sector specialists, relative value analysts |
| **Length** | Side-by-side comparison tables with rankings summary |
| **Output** | `reports/output/comparison_{GROUP}_{YYYYMMDD_HHMMSS}.md` + `.csv` |
| **Key Requirement** | Highlight relative strengths and weaknesses across peers |
| **Data Sources Used** | FundamentalsClient (ratios), yfinance (info, prices), RiskAnalyzer (risk metrics) |

**Pre-built comparison groups available:**

| Group Key | Description | Companies |
|-----------|-------------|-----------|
| `euv` | EUV Lithography Supply Chain | ASML, Lasertec, Shin-Etsu, JSR, TOK |
| `semicon_equip` | Semiconductor Equipment Leaders | ASML, AMAT, LRCX, KLAC, TEL, Advantest, Lasertec, Disco |
| `wafers` | Silicon Wafer Manufacturers | Shin-Etsu, SUMCO |
| `packaging` | Advanced Packaging (CoWoS/HBM) | Ajinomoto, Ibiden, Shinko Electric |
| `eda` | EDA & Chip Design IP | Synopsys, Cadence, ARM |
| `memory` | AI Memory (HBM Players) | Micron, SK Hynix |
| `networking` | AI Data Center Networking | Broadcom, Arista, Amphenol |
| `japan_moats` | Japanese AI Moat Champions | TEL, Lasertec, Advantest, Shin-Etsu, Ajinomoto, Murata, Hamamatsu, Disco |
| `power_cooling` | AI Power & Cooling | Vertiv, Monolithic Power, Nidec |

**The comparison report must contain these tables in order:**
1. Valuation (Mkt Cap, P/E Fwd, P/E Trail, PEG, P/B, EV/EBITDA, P/S)
2. Profitability (Gross Margin, Op Margin, ROE, ROA)
3. Growth (Rev Growth, Earn Growth, Mkt Cap)
4. Price Performance (1M, 3M, 6M, 1Y)
5. Risk Profile (Volatility, Beta, Sharpe, Max Drawdown)
6. Financial Health (D/E, Current Ratio, Div Yield)
7. Rankings Summary (cheapest, most profitable, fastest growing, best performance, best risk-adjusted)

### 3.4 Quick Analysis (`main.py analyze` output)

| Attribute | Specification |
|-----------|--------------|
| **When** | Rapid assessment with composite score |
| **Audience** | Anyone needing quick insight |
| **Length** | Summary format (typically 50-100 lines) |
| **Output** | `reports/output/{TICKER}_{YYYYMMDD_HHMMSS}.md` + `.json` |
| **Key Requirement** | Composite score + recommendation + component breakdown + top reasons |

**Quick Analysis must always contain:**
1. Composite score (X/100) and recommendation on the first two lines
2. Component scores table (all 5 dimensions with weights)
3. Fundamental analysis highlights (health score, growth score, reasons)
4. Valuation verdict (DCF intrinsic value, margin of safety, verdict)
5. Technical signals summary (each indicator signal and reason)
6. Risk profile summary (risk level, volatility, beta, Sharpe, max drawdown, VaR)
7. Sentiment summary (overall label and score)
8. Disclaimer

---

## 4. Composite Scoring System Reference

All reports that include a composite score must use the official scoring system defined in `src/analysis/scoring.py`.

### 4.1 Score Weights

| Dimension | Weight | Source Module | What It Measures |
|-----------|--------|--------------|-----------------|
| Fundamental | 30% | `src/analysis/fundamental.py` | Financial health (current ratio, D/E, ROE), growth (revenue, earnings), valuation (P/E, PEG) |
| Valuation | 25% | `src/analysis/valuation.py` | DCF intrinsic value vs. current price (margin of safety) |
| Technical | 20% | `src/analysis/technical.py` | RSI, MACD, MA crossover, Bollinger Band signals |
| Risk | 15% | `src/analysis/risk.py` | Inverse of annualized volatility (higher score = lower risk) |
| Sentiment | 10% | `src/analysis/sentiment.py` | News FinBERT sentiment, Reddit upvote ratio |

### 4.2 Recommendation Thresholds

| Composite Score | Recommendation | Report Color/Emphasis |
|----------------|---------------|----------------------|
| 75-100 | **STRONG BUY** | Bold, prominently displayed |
| 60-74 | **BUY** | Bold |
| 45-59 | **HOLD** | Standard |
| 30-44 | **SELL** | Bold |
| 0-29 | **STRONG SELL** | Bold, prominently displayed |

### 4.3 Score Validation Rules

- The composite score MUST equal the weighted sum of component scores: `composite = fundamental*0.30 + valuation*0.25 + technical*0.20 + risk*0.15 + sentiment*0.10`
- Each component score must be in the range 0-100
- The composite score is rounded to 1 decimal place
- If a component analysis fails, a neutral fallback of 50 is used (logged as a warning)
- The recommendation MUST match the composite score threshold -- no manual overrides without documented justification

### 4.4 Moat Scoring System (AI Supply Chain Companies)

For companies in the AI moat universe (`configs/ai_moat_universe.yaml`), a separate moat score is computed by `src/analysis/moat.py`:

| Moat Dimension | Weight | Source |
|---------------|--------|--------|
| Market Dominance | 20% | Qualitative (from YAML config or manual override) |
| Switching Costs | 15% | Qualitative |
| Technology Lock-in | 15% | Qualitative |
| Supply Chain Criticality | 20% | Qualitative |
| Pricing Power | 15% | Quantitative (gross/operating margin levels and trends) |
| Barriers to Entry | 15% | Qualitative |

**Moat Classifications:**

| Moat Score | Classification |
|-----------|---------------|
| 80-100 | WIDE MOAT |
| 60-79 | NARROW MOAT |
| 40-59 | WEAK MOAT |
| 0-39 | NO MOAT |

---

## 5. Report Structure Standards

Every report section has a defined structure. The following subsections document the exact content requirements for each section of a Full Investment Memo. Other report types use subsets of these sections.

### 5.1 Executive Summary (Always First)

The executive summary is the single most important section. A reader who reads nothing else should get the full investment picture from this section alone.

**Required elements:**

```
## 1. Executive Summary

| | |
|---|---|
| **Company** | {full company name} |
| **Ticker** | {ticker, including exchange suffix} |
| **Sector** | {sector} |
| **Industry** | {industry} |
| **Country** | {country code or full name} |
| **Market Cap** | ${X.X}B |
| **Employees** | {N:,} |
| **Currency** | {reporting currency} |

> {Business description -- 2-3 sentences maximum}
```

**For Quick Analysis reports, the executive summary is condensed to:**
- Line 1: `## Composite Score: {X.X}/100`
- Line 2: `## Recommendation: **{RECOMMENDATION}**`
- Component scores table immediately following

**Rules:**
- Recommendation appears in the first two visible lines of the report
- One-sentence investment thesis follows the profile table
- Top 3 reasons supporting the recommendation are listed as bullet points
- Top 2 risks to the thesis are listed as bullet points
- All key metrics (Price, Market Cap, P/E, Moat Score if applicable, YTD Performance) appear in the profile table
- This section must stand alone -- assume the reader will not continue

### 5.2 Company Profile Section

For Full Investment Memos, this is embedded in the Executive Summary table. The following data points must be present:

- Company name and ticker (including ADR ticker if applicable, e.g., `8035.T` / ADR: `TOELY`)
- Sector and industry (from yfinance `info.sector` and `info.industry`)
- Country of domicile
- Market cap in USD billions (converted at current FX if non-USD)
- Enterprise value (when available)
- Full-time employee count (formatted with thousands separator)
- Business description (truncated to 500 characters in the report)
- AI supply chain position and criticality (from `ai_moat_universe.yaml` `moat` field)
- Key products/services relevant to AI (from `ai_moat_universe.yaml` `moat` field)
- AI exposure percentage (from `ai_moat_universe.yaml` `ai_exposure_pct` field)

### 5.3 Financial Analysis Section (Key Ratios)

**Required ratios table:**

| Metric | Display Label | Format | Source Field |
|--------|-------------|--------|-------------|
| P/E (Trailing) | P/E (Trailing) | `{X.XX}` | `pe_trailing` |
| P/E (Forward) | P/E (Forward) | `{X.XX}` | `pe_forward` |
| PEG Ratio | PEG Ratio | `{X.XX}` | `peg_ratio` |
| P/B Ratio | P/B Ratio | `{X.XX}` | `pb_ratio` |
| P/S Ratio | P/S Ratio | `{X.XX}` | `ps_ratio` |
| EV/EBITDA | EV/EBITDA | `{X.XX}` | `ev_ebitda` |
| Profit Margin | Profit Margin | `{X.X}%` | `profit_margin` (multiply by 100) |
| Operating Margin | Operating Margin | `{X.X}%` | `operating_margin` (multiply by 100) |
| ROE | Return on Equity | `{X.X}%` | `roe` (multiply by 100) |
| ROA | Return on Assets | `{X.X}%` | `roa` (multiply by 100) |
| D/E | Debt/Equity | `{X.X}` | `debt_to_equity` |
| Current Ratio | Current Ratio | `{X.XX}` | `current_ratio` |
| Dividend Yield | Dividend Yield | `{X.XX}%` | `dividend_yield` (multiply by 100) |
| Revenue Growth | Revenue Growth | `{X.X}%` | `revenue_growth` (multiply by 100) |
| Earnings Growth | Earnings Growth | `{X.X}%` | `earnings_growth` (multiply by 100) |

**Financial health scoring (from FundamentalAnalyzer):**
- Health score: X/6 (based on current ratio, D/E, ROE)
- Growth score: X/4 (based on revenue growth, earnings growth)
- Each score must list the specific reasons (e.g., "Strong current ratio: 2.15")

### 5.4 Financial Statements Section (Annual)

Three sub-tables are required, each showing up to 4 years of annual data sorted most-recent-first:

**Income Statement metrics to include:**
- Total Revenue
- Gross Profit
- Operating Income
- Net Income
- EBITDA
- Basic EPS
- Gross Margin % (computed: Gross Profit / Total Revenue * 100)
- Operating Margin % (computed: Operating Income / Total Revenue * 100)
- Net Margin % (computed: Net Income / Total Revenue * 100)

**Balance Sheet metrics to include:**
- Total Assets
- Total Liabilities Net Minority Interest
- Stockholders Equity
- Total Debt
- Cash And Cash Equivalents

**Cash Flow Statement metrics to include:**
- Operating Cash Flow
- Capital Expenditure
- Free Cash Flow

**Number formatting for financial statements:**

| Magnitude | Format | Example |
|-----------|--------|---------|
| >= $1 trillion | `${X.X}T` | `$1.2T` |
| >= $1 billion | `${X.X}B` | `$45.3B` |
| >= $1 million | `${X.X}M` | `$892.1M` |
| >= $1 thousand | `${X.X}K` | `$5.2K` |
| < $1 thousand | `${X.XX}` | `$42.50` |
| Null/NaN | `--` (em dash) | `--` |

### 5.5 Technical Analysis Section

**Required elements:**

1. **Signals Table** -- one row per indicator:

| Indicator | Signal | Detail |
|-----------|--------|--------|
| RSI | BUY/SELL/HOLD | Oversold/Overbought/Neutral + value |
| MA_CROSSOVER | BUY/SELL/HOLD | Price position relative to SMA 20/50 |
| MACD | BUY/SELL | MACD above/below signal line |
| BBANDS | BUY/SELL/HOLD | Below lower/Above upper/Within bands |

2. **Support & Resistance** -- three specific price levels:
   - Current Price (formatted to 2 decimal places)
   - Support Level (20-day rolling low)
   - Resistance Level (20-day rolling high)

3. **Trend Assessment** (when included in full memo):
   - BULLISH: majority of signals are BUY
   - BEARISH: majority of signals are SELL
   - NEUTRAL: mixed signals

**Technical signal scoring for composite:**
- Score = (count of BUY signals / total signals) * 100
- A stock with 3 out of 4 BUY signals scores 75

### 5.6 Valuation Section

**DCF Analysis table (required when data is available):**

| Parameter | Value |
|-----------|-------|
| Current FCF | `${formatted}` |
| Growth Rate | `{X.X}%` |
| Terminal Growth | `{X.X}%` |
| Discount Rate (WACC) | `{X.X}%` |
| **Intrinsic Value/Share** | **`${X.XX}`** |
| Current Price | `${X.XX}` |
| Margin of Safety | `{X.X}%` |
| **Verdict** | **UNDERVALUED / FAIRLY VALUED / OVERVALUED** |

**Valuation verdict thresholds (from ValuationAnalyzer):**
- UNDERVALUED: margin of safety > 15%
- FAIR: margin of safety between -10% and +15%
- OVERVALUED: margin of safety < -10%

**Valuation score for composite:**
- Score = 50 + margin_of_safety_pct (clamped to 0-100)
- A stock with 30% margin of safety scores 80
- A stock with -20% margin of safety scores 30

**When DCF is unavailable:**
- Display: `DCF not available: {error reason}`
- Use neutral fallback score of 50 for composite

### 5.7 Risk Assessment Section

**Required risk metrics table:**

| Metric | Display Format | Calculation Reference |
|--------|---------------|---------------------|
| Risk Level | `LOW` / `MODERATE` / `HIGH` / `VERY HIGH` | Based on annualized volatility thresholds |
| Annualized Volatility | `{X.XXXX}` (4 decimal places) | `daily_std * sqrt(252)` |
| Beta (vs SPY) | `{X.XXXX}` | `cov(stock, SPY) / var(SPY)` |
| Sharpe Ratio | `{X.XXXX}` | `(mean_excess_return / std_excess) * sqrt(252)`, risk-free = 4% |
| Sortino Ratio | `{X.XXXX}` | Same as Sharpe but using downside deviation only |
| Max Drawdown | `{X.XXXX}` (as decimal) | Minimum of `(price - cummax) / cummax` |
| Value at Risk (95%) | `{X.XXXX}` | 5th percentile of daily returns |
| Conditional VaR (95%) | `{X.XXXX}` | Mean of returns below VaR threshold |

**Risk level thresholds:**

| Annualized Volatility | Risk Level |
|----------------------|------------|
| < 0.15 (15%) | LOW |
| 0.15 - 0.30 | MODERATE |
| 0.30 - 0.50 | HIGH |
| > 0.50 (50%) | VERY HIGH |

**Risk score for composite:**
- Score = (1 - volatility) * 100 (clamped to 0-100)
- A stock with 20% volatility scores 80
- A stock with 45% volatility scores 55

### 5.8 Sentiment Section

**Required elements:**

1. Overall sentiment label: `BULLISH` / `NEUTRAL` / `BEARISH` / `NO DATA`
2. Overall sentiment score (range: -1.0 to +1.0, displayed to 3 decimal places)
3. News sentiment breakdown (when available):
   - Positive article percentage
   - Negative article percentage
   - Neutral article percentage
   - Total article count analyzed
4. Reddit sentiment (when available):
   - Post count
   - Average score
   - Average upvote ratio
5. Analyst recommendations (when available):
   - Latest 5 analyst actions

**Sentiment label thresholds:**

| Overall Score | Label |
|--------------|-------|
| > 0.2 | BULLISH |
| -0.2 to 0.2 | NEUTRAL |
| < -0.2 | BEARISH |
| No data | NO DATA |

**Sentiment score for composite:**
- Score = 50 + (overall_score * 100) (clamped to 0-100)
- A stock with +0.3 overall score gets sentiment score of 80
- A stock with -0.15 overall score gets sentiment score of 35

### 5.9 Moat Analysis Section (AI Supply Chain Companies Only)

This section applies exclusively to companies tracked in `configs/ai_moat_universe.yaml` across the 8 categories:

1. Semiconductor Equipment
2. Specialty Chemicals & Materials
3. Advanced Packaging & Substrates
4. Electronic Components
5. EDA & Chip Design IP
6. Networking & Interconnect
7. Power & Cooling
8. Foundry & Memory

**Required elements:**

1. Moat score (X/100) and classification (WIDE MOAT / NARROW MOAT / WEAK MOAT / NO MOAT)
2. Six-dimension breakdown table:

| Dimension | Score | Weight | Weighted Contribution |
|-----------|-------|--------|----------------------|
| Market Dominance | X/100 | 20% | X.X |
| Switching Costs | X/100 | 15% | X.X |
| Technology Lock-in | X/100 | 15% | X.X |
| Supply Chain Criticality | X/100 | 20% | X.X |
| Pricing Power | X/100 | 15% | X.X |
| Barriers to Entry | X/100 | 15% | X.X |
| **Composite** | **X/100** | **100%** | **X.X** |

3. Moat durability assessment (qualitative: is the moat widening, stable, or narrowing?)
4. Key competitive advantages (from the `moat` description field in YAML)
5. AI exposure percentage (from `ai_exposure_pct` in YAML)
6. Competitive risks that could erode the moat

### 5.10 Composite Score Breakdown

**Required in every report that includes a composite score:**

```markdown
### Composite Score Breakdown

| Dimension | Score | Weight | Contribution |
|-----------|-------|--------|-------------|
| Fundamental | {X.X}/100 | 30% | {X.X} |
| Valuation | {X.X}/100 | 25% | {X.X} |
| Technical | {X.X}/100 | 20% | {X.X} |
| Risk | {X.X}/100 | 15% | {X.X} |
| Sentiment | {X.X}/100 | 10% | {X.X} |
| **Composite** | **{X.X}/100** | **100%** | **{X.X}** |

**Strongest dimension:** {name} ({score})
**Weakest dimension:** {name} ({score})
```

- The Contribution column = Score * Weight
- The sum of all Contribution values MUST equal the Composite Score
- Always identify the strongest and weakest dimensions explicitly

---

## 6. Writing Standards

### 6.1 Tone and Style

**Do:**
- Write in a professional, objective, evidence-based tone
- Present both bull and bear cases fairly and with equal rigor
- Use precise, quantified language: "revenue grew 23.4% YoY" not "revenue grew significantly"
- State confidence levels explicitly: "DCF suggests 25% upside, though this assumes 8% FCF growth which is above the 5-year average of 6%"
- Attribute every claim to data: "P/E of 15.2x is below the 5-year median of 18.7x"
- Use active voice: "The company generates $2.1B in free cash flow" not "Free cash flow of $2.1B is generated"

**Do not:**
- Use promotional language, hype, or superlatives without data backing ("incredible growth", "amazing opportunity")
- Use weasel words without quantification: "might", "could potentially", "seems to", "arguably"
- Editorialize without evidence: "management is excellent" (instead: "management has delivered 15% CAGR over 5 years")
- Cherry-pick data that supports a predetermined conclusion
- Use emojis, exclamation marks, or informal language
- Make predictions without stating assumptions and uncertainty ranges

### 6.2 Data Presentation Rules

**Numerical formatting standards:**

| Data Type | Format | Example |
|-----------|--------|---------|
| Ratios (P/E, P/B, EV/EBITDA, PEG, D/E) | 2 decimal places | `25.66` |
| Percentages (margins, growth, yields) | 1 decimal place + % symbol | `23.4%` |
| Market cap | Nearest $100M in billions | `$82.9B` |
| Share price | 2 decimal places with currency symbol | `$542.30`, `JPY 24,150` |
| Volatility / Beta / Sharpe | 4 decimal places | `0.4783` |
| VaR / CVaR | 4 decimal places | `-0.0312` |
| Moat scores | 1 decimal place | `87.5` |
| Composite score | 1 decimal place | `67.3` |

**Currency handling:**
- All market caps and enterprise values normalized to USD for cross-company comparison
- Note original reporting currency in the profile table (e.g., `Currency: JPY`)
- For Japanese tickers (`.T` suffix), prices are displayed in JPY; USD conversion noted separately
- For Taiwanese tickers (`.TW` suffix), prices are displayed in TWD
- For Korean tickers (`.KS` suffix), prices are displayed in KRW
- ADR prices are in USD and labeled accordingly

**Time period labeling -- always explicit:**
- `TTM` -- Trailing twelve months
- `FY2025` -- Fiscal year ending in calendar 2025
- `Q3 2025` -- Third quarter of fiscal/calendar 2025
- `1Y`, `3M`, `6M`, `1M` -- Performance lookback periods
- `2y` -- Risk analysis lookback period (default for RiskAnalyzer)
- Never present a number without its time context

**Null / missing data handling:**
- Display `N/A` for missing profile fields
- Display `--` (em dash) for missing financial statement line items
- Display `None` or omit from tables for missing ratio values
- Never display `NaN`, `nan`, `inf`, or `-inf` in any report
- If a component score falls back to 50 due to an error, note this in the report

### 6.3 Markdown Formatting Standards

**Heading hierarchy:**

| Level | Usage | Example |
|-------|-------|---------|
| `#` (H1) | Report title only -- exactly one per report | `# Investment Deep Dive: ASML Holding (ASML)` |
| `##` (H2) | Major sections (numbered) | `## 2. Key Financial Ratios` |
| `###` (H3) | Subsections within a major section | `### Income Statement` |
| `####` (H4) | Rare -- only for deep nesting within subsections | `#### Margin Trends` |

**Element usage:**

| Element | When to Use |
|---------|------------|
| Tables | All structured data, comparisons, multi-metric displays. Always align columns. |
| Bold (`**text**`) | Key metrics, recommendations, verdicts, important values |
| Italic (`*text*`) | Report metadata (generated date, disclaimers), data source notes |
| Bullet points (`-`) | Lists of factors, risks, reasons, qualitative observations |
| Blockquotes (`>`) | Company descriptions, executive summary thesis |
| Code blocks (`` ` ``) | Formulas, calculation methodologies, ticker symbols in running text |
| Horizontal rules (`---`) | Between major sections and before the disclaimer |

**Table formatting rules:**
- Always include a header row and separator row
- Right-align numeric columns (`:` alignment in markdown)
- Left-align text columns
- Use consistent column widths within a report
- No empty tables -- if data is unavailable, state why in text

**Report metadata -- always present at the top:**
```markdown
# {Report Title}: {Company Name} ({Ticker})
*{Report Type} -- {YYYY-MM-DD HH:MM}*

---
```

### 6.4 Addressing International Tickers

The AI moat universe includes tickers across multiple exchanges. Apply these rules consistently:

| Exchange Suffix | Country | Example | ADR Column |
|----------------|---------|---------|------------|
| `.T` | Japan (Tokyo) | `8035.T` | Include ADR ticker if available (e.g., `TOELY`) |
| `.TW` | Taiwan | `2330.TW` | Include ADR (e.g., `TSM`) |
| `.KS` | South Korea | `000660.KS` | Include ADR (e.g., `HXSCL`) |
| (none) | US | `ASML` | N/A |

- When displaying company data, always show both the local ticker and the ADR (if applicable)
- The `ai_universe_scanner.py` prefers ADR tickers for data fetching when available (via `comp.get("adr") or comp["ticker"]`)
- If the ADR fetch fails, the scanner falls back to the local ticker

---

## 7. Report Section Ordering

### 7.1 Full Investment Memo Section Order

1. Report title and metadata
2. Executive Summary (profile table + description)
3. Key Financial Ratios
4. Financial Statements (Income, Balance Sheet, Cash Flow)
5. Technical Analysis (Signals + Support/Resistance)
6. Risk Assessment
7. Valuation (DCF)
8. Peer Comparison (if peers provided)
9. Moat Analysis (if AI supply chain company)
10. Composite Score Breakdown (if composite score computed)
11. Disclaimer

### 7.2 Universe Scanner Section Order

1. Report title and metadata
2. Summary stats (total companies, categories)
3. Top 15 by Moat Score
4. Category breakdowns (one table per category)
5. Best 1-Year Performers
6. Value + Moat Opportunities
7. Disclaimer

### 7.3 Comparative Analysis Section Order

1. Report title and metadata
2. Valuation comparison table
3. Profitability comparison table
4. Growth comparison table
5. Price Performance table
6. Risk Profile table
7. Financial Health table
8. Rankings Summary (text bullets)
9. Disclaimer

### 7.4 Quick Analysis Section Order

1. Composite Score headline
2. Recommendation headline
3. Component Scores table
4. Fundamental Analysis details
5. Valuation details
6. Technical Signals
7. Risk Profile
8. Sentiment
9. Disclaimer

---

## 8. Quality Checklist Before Publishing

Every report must pass this checklist before being saved to `reports/output/`. For automated reports, these checks should be validated programmatically where possible. For AI agent-generated commentary, the agent must self-verify against this list.

### 8.1 Content Accuracy

- [ ] Executive summary is self-contained -- a reader gets the full picture without scrolling
- [ ] All scores add up correctly: composite = weighted sum of components (verify: `fund*0.30 + val*0.25 + tech*0.20 + risk*0.15 + sent*0.10`)
- [ ] Recommendation matches the composite score threshold (no score-recommendation mismatch)
- [ ] No contradictions between sections (e.g., "strong growth" in text but negative revenue growth in data table)
- [ ] Financial statement figures are internally consistent (e.g., Net Margin = Net Income / Revenue)
- [ ] Moat score matches the sum of weighted dimension scores

### 8.2 Data Integrity

- [ ] All data points have sources or calculation methodology noted
- [ ] Currency and units are consistent throughout (no mixing USD and JPY without conversion)
- [ ] Peer comparisons use the same time period for all companies
- [ ] No stale data -- report date and data as-of date are clearly stated
- [ ] Ticker symbols are correct (especially `.T`, `.TW`, `.KS` suffixes)
- [ ] ADR tickers are noted where applicable
- [ ] No `NaN`, `inf`, or raw error strings appear in the output

### 8.3 Analytical Rigor

- [ ] Risk factors actually address key risks specific to the company, not generic boilerplate
- [ ] Valuation assumptions (growth rate, WACC, terminal growth) are stated explicitly
- [ ] Bull case and bear case are both addressed, not just one side
- [ ] Technical signals are current (based on most recent trading day data)
- [ ] Sentiment data is recent (check article dates, not just counts)
- [ ] Peer comparison companies are actually peers (same industry/category)

### 8.4 Formatting

- [ ] Exactly one H1 heading (the report title)
- [ ] All tables render correctly (header + separator + data rows)
- [ ] No broken markdown (unclosed bold, missing table columns)
- [ ] Numbers follow the formatting standards in Section 6.2
- [ ] Report ends with the disclaimer section
- [ ] File saved with correct naming convention

---

## 9. Common Report Writing Mistakes and How to Avoid Them

### 9.1 Burying the Lead

**Wrong:** Starting with company history, then showing 3 pages of tables, then finally the recommendation on page 4.

**Right:** The recommendation and composite score appear in the first 2 lines of the report. The executive summary is the first section. A reader should know BUY/SELL/HOLD within 5 seconds of opening the report.

### 9.2 Data Dump Without Interpretation

**Wrong:**
```
| P/E (Fwd) | 25.66 |
| P/B | 2.85 |
| EV/EBITDA | 70.02 |
```

**Right:**
```
| P/E (Fwd) | 25.66 |
| P/B | 2.85 |
| EV/EBITDA | 70.02 |

Forward P/E of 25.66x is below the EDA peer median of 38.9x, suggesting
relative value. However, EV/EBITDA of 70.0x reflects the impact of the
pending Ansys acquisition on earnings.
```

Every table should be followed by 1-3 sentences explaining what the numbers mean in context.

### 9.3 Confirmation Bias

**Wrong:** Presenting only data points that support the recommendation while omitting contradictory evidence.

**Right:** Explicitly address contradictory evidence:
```
Despite the BUY recommendation, investors should note:
- Forward P/E of 55.8x is 2.2x the sector median
- Earnings declined 12.3% last quarter
- Beta of 2.52 implies significantly higher volatility than the market
```

### 9.4 Over-Precision in Estimates

**Wrong:** "Our DCF model yields an intrinsic value of $127.43 per share."

**Right:** "Our DCF model yields an intrinsic value of approximately $127/share, though this estimate is sensitive to growth assumptions (8% base case; range of $95-$160 at 5%-12% growth rates)."

DCF values should be presented with explicit sensitivity context. The platform's DCF uses a single growth rate; acknowledge this limitation.

### 9.5 Generic Risk Factors

**Wrong:**
```
Key risks:
- Macroeconomic headwinds
- Competitive pressures
- Regulatory risk
```

**Right:**
```
Key risks:
- US export controls on semiconductor equipment to China could reduce
  Tokyo Electron's China revenue (currently ~25% of total) by $2-3B annually
- ASML's EUV monopoly partially mitigates competitive risk, but High-NA
  EUV adoption timing could shift capex cycles by 1-2 quarters
- JPY/USD volatility: a 10% JPY strengthening reduces USD-translated
  earnings by approximately 8% for Japan-domiciled companies
```

### 9.6 Missing Context for Numbers

**Wrong:** "Revenue growth was 37.8%."

**Right:** "Revenue growth of 37.8% YoY significantly exceeded the EDA sector average of 12% and the company's own 5-year CAGR of 15%, driven primarily by the Ansys acquisition rather than organic growth."

Raw numbers without benchmarks, historical comparison, or peer context are meaningless.

### 9.7 Inconsistent Formatting Within a Report

**Wrong:** Mixing `23.4%` and `23.44%` and `23%` for the same type of metric. Using `$45.3B` in one table and `45,300M` in another.

**Right:** Pick one format per metric type (see Section 6.2) and apply it uniformly throughout the entire report.

### 9.8 Stale or Undated Data

**Wrong:** Presenting financial data without specifying whether it is TTM, FY2025, or Q3 2025.

**Right:** Every data point has a time label. The report header includes both the generation timestamp and the data as-of date. If price data is delayed, note it.

---

## 10. Report Output Formats

### 10.1 Markdown (.md) -- Primary Format

- Human-readable, Git-friendly, renders on GitHub
- Used for all narrative reports (deep dive, comparison, universe scan)
- Generated by all scripts and the ReportGenerator class
- Stored in `reports/output/`

### 10.2 JSON (.json) -- Machine-Parseable Format

- Generated alongside markdown by `ReportGenerator.full_report()`
- Contains the raw `result` dict from `StockScorer.score()`
- Includes: `ticker`, `composite_score`, `recommendation`, `component_scores`, `weights`, `details`
- All values serialized with `json.dumps(result, indent=2, default=str)`
- Used for programmatic consumption, dashboard ingestion, or downstream pipeline input

**JSON schema structure:**
```json
{
  "ticker": "ASML",
  "composite_score": 67.3,
  "recommendation": "BUY",
  "component_scores": {
    "fundamental": 72.5,
    "valuation": 65.0,
    "technical": 75.0,
    "sentiment": 58.0,
    "risk": 55.0
  },
  "weights": {
    "fundamental": 0.30,
    "valuation": 0.25,
    "technical": 0.20,
    "sentiment": 0.10,
    "risk": 0.15
  },
  "details": {
    "fundamental": { ... },
    "valuation": { ... },
    "technical": { ... },
    "sentiment": { ... },
    "risk": { ... }
  }
}
```

### 10.3 CSV (.csv) -- Bulk Data Format

- Generated by `ai_universe_scanner.py` and `ai_comparisons.py` alongside markdown
- Contains the full DataFrame as a flat table
- Used for Excel/Google Sheets import, bulk analysis, pivot tables
- Column names match the pandas DataFrame columns exactly

---

## 11. File Naming Conventions

### 11.1 Standard Naming Pattern

```
{descriptor}_{identifier}_{YYYYMMDD_HHMMSS}.{ext}
```

| Report Type | Filename Pattern | Example |
|-------------|-----------------|---------|
| Full Investment Memo | `deep_dive_{TICKER}_{YYYYMMDD_HHMMSS}.md` | `deep_dive_ASML_20260209_143022.md` |
| Quick Analysis (MD) | `{TICKER}_{YYYYMMDD_HHMMSS}.md` | `ASML_20260209_143022.md` |
| Quick Analysis (JSON) | `{TICKER}_{YYYYMMDD_HHMMSS}.json` | `ASML_20260209_143022.json` |
| Universe Scan (MD) | `ai_moat_scan_{YYYYMMDD_HHMMSS}.md` | `ai_moat_scan_20260209_143022.md` |
| Universe Scan (CSV) | `ai_moat_scan_{YYYYMMDD_HHMMSS}.csv` | `ai_moat_scan_20260209_143022.csv` |
| Comparison (MD) | `comparison_{GROUP}_{YYYYMMDD_HHMMSS}.md` | `comparison_eda_20260209_225600.md` |
| Comparison (CSV) | `comparison_{GROUP}_{YYYYMMDD_HHMMSS}.csv` | `comparison_eda_20260209_225600.csv` |

### 11.2 Rules

- All files saved to `reports/output/` directory (configured in `src/config.py` as `Paths.REPORTS_OUTPUT`)
- Timestamps use 24-hour format, no timezone suffix (local time assumed)
- Ticker symbols preserve exchange suffixes: `8035.T` becomes `8035.T` in the filename
- Group slugs use underscores, lowercase: `japan_moats`, `power_cooling`
- Never overwrite existing reports -- the timestamp ensures uniqueness

---

## 12. Archival and Versioning

### 12.1 Retention Policy

- All generated reports are retained indefinitely in `reports/output/`
- Reports are Git-trackable (markdown and CSV are text-based)
- JSON files are also retained for programmatic access to historical scores
- The accumulation of reports enables tracking recommendation accuracy over time

### 12.2 Recommendation Tracking

To evaluate the quality of the platform's recommendations over time:

1. Parse historical JSON files for `ticker`, `composite_score`, `recommendation`, and generation date
2. Compare recommendation date price to subsequent 1M, 3M, 6M, 1Y price performance
3. Track hit rate: what percentage of BUY recommendations outperformed the benchmark?
4. Track score stability: how much does a company's composite score change between runs?

### 12.3 Data Provenance

Every JSON output implicitly records data provenance through the `details` dict. To make provenance explicit, reports should note:

- **Generation timestamp** -- in the report header (e.g., `*Generated: 2026-02-09 14:30*`)
- **Data sources** -- list which APIs were called (yfinance, Finnhub, FRED, etc.)
- **Data freshness** -- note if any data source returned cached or stale data
- **Fallback usage** -- note if any component used the neutral fallback score of 50

---

## 13. Disclaimer Requirements

Every report must end with a disclaimer section. This is non-negotiable.

### 13.1 Standard Disclaimer (Short Form)

Used for Quick Analysis and Comparison reports:

```markdown
---
*Disclaimer: Automated analysis for informational purposes only. Not financial advice.*
```

### 13.2 Full Disclaimer (Long Form)

Used for Full Investment Memos:

```markdown
---

*Disclaimer: This is an automated analysis for informational purposes only.
It does not constitute financial advice. Always conduct your own research
and consult with qualified financial professionals before making investment decisions.*
```

### 13.3 Disclaimer Rules

- The disclaimer MUST be the last element in every report
- It is preceded by a horizontal rule (`---`)
- It is formatted in italics
- It must not be modified, abbreviated further, or removed
- AI agents citing platform data in conversation must include a verbal disclaimer

---

## 14. AI Agent Communication Guidelines

When an AI agent (such as Claude) uses FE-Analyst data to communicate findings to a user, the following additional guidelines apply:

### 14.1 Verbal Report Delivery

- Lead with the recommendation and score: "ASML scores 67.3/100, a BUY recommendation."
- Follow with the top 2-3 supporting reasons
- Then address the top 1-2 risks
- Offer to drill into any specific section
- Always note the data generation timestamp

### 14.2 Answering Follow-up Questions

- When asked about a specific metric, provide the exact number AND context (peer comparison, historical range)
- When asked "why", trace back to the component score and its underlying factors
- When asked to compare, pull from the comparison report format (Section 3.3)
- Never fabricate numbers -- if data is unavailable, say so explicitly

### 14.3 Expressing Uncertainty

- If a component used the fallback score of 50, disclose this: "Note: sentiment analysis was unavailable for this ticker, so a neutral score of 50 was used."
- If DCF assumptions are aggressive or conservative relative to historical performance, flag this
- If moat scores are qualitative (from YAML config), note they represent expert assessment, not algorithmic computation
- Never present a composite score as more precise than it is -- it is a screening tool, not a definitive valuation

### 14.4 Multi-Company Discussions

- When discussing multiple companies, always use consistent metrics for comparison
- Present data in tabular form when comparing 3+ companies
- Rank by the most relevant metric for the user's question
- Always note if companies are in different currencies or reporting periods

---

## 15. Report Templates Reference

### 15.1 Full Investment Memo Template

```markdown
# Investment Deep Dive: {Company Name} ({Ticker})
*Financial Analyst Report -- {YYYY-MM-DD HH:MM}*

---

## 1. Executive Summary

| | |
|---|---|
| **Company** | {name} |
| **Ticker** | {ticker} |
| **Sector** | {sector} |
| **Industry** | {industry} |
| **Country** | {country} |
| **Market Cap** | ${X.X}B |
| **Employees** | {N:,} |
| **Currency** | {currency} |

> {Business description, 2-3 sentences}

## 2. Key Financial Ratios

| Metric | Value |
|--------|-------|
| P/E (Trailing) | {X.XX} |
| ... | ... |

## 3. Financial Statements (Annual)

### Income Statement

| Metric | {Year1} | {Year2} | {Year3} | {Year4} |
|--------|---------|---------|---------|---------|
| Total Revenue | ... | ... | ... | ... |
| ... | ... | ... | ... | ... |

### Balance Sheet
{same format}

### Cash Flow Statement
{same format}

## 4. Technical Analysis

### Signals

| Indicator | Signal | Detail |
|-----------|--------|--------|
| RSI | {signal} | {reason} |
| ... | ... | ... |

### Support & Resistance

- **Current Price:** {X.XX}
- **Support:** {X.XX}
- **Resistance:** {X.XX}

## 5. Risk Assessment

| Metric | Value |
|--------|-------|
| **Risk Level** | {level} |
| Annualized Volatility | {X.XXXX} |
| ... | ... |

## 6. Valuation

### DCF Analysis

| Parameter | Value |
|-----------|-------|
| Current FCF | {formatted} |
| ... | ... |
| **Verdict** | **{verdict}** |

## 7. Peer Comparison

{pandas DataFrame .to_markdown() output}

---

*Disclaimer: This is an automated analysis for informational purposes only.
It does not constitute financial advice. Always conduct your own research
and consult with qualified financial professionals before making investment decisions.*
```

### 15.2 Quick Analysis Template

```markdown
# Stock Analysis: {TICKER}
*Generated: {YYYY-MM-DD HH:MM}*

---

## Composite Score: {X.X}/100
## Recommendation: **{RECOMMENDATION}**

### Component Scores

| Component | Score | Weight |
|-----------|-------|--------|
| Fundamental | {X.X}/100 | 30% |
| Valuation | {X.X}/100 | 25% |
| Technical | {X.X}/100 | 20% |
| Risk | {X.X}/100 | 15% |
| Sentiment | {X.X}/100 | 10% |

### Fundamental Analysis
- **Sector:** {sector}
- **Financial Health:** {X}/{max_score}
  - {reason 1}
  - {reason 2}
- **Growth:** {X}/{max_score}
  - {reason 1}

### Valuation (DCF)
- **Intrinsic Value:** ${X.XX}
- **Current Price:** ${X.XX}
- **Margin of Safety:** {X.X}%
- **Verdict:** {verdict}

### Technical Signals

- **RSI:** {signal} - {reason}
- **MA_CROSSOVER:** {signal} - {reason}
- **MACD:** {signal} - {reason}
- **BBANDS:** {signal} - {reason}

### Risk Profile
- **Risk Level:** {level}
- **Annualized Volatility:** {X.XXXX}
- **Beta:** {X.XXXX}
- **Sharpe Ratio:** {X.XXXX}
- **Max Drawdown:** {X.XXXX}
- **VaR (95%):** {X.XXXX}

### Sentiment
- **Overall:** {label} ({X.XXX})

---
*Disclaimer: This is an automated analysis for informational purposes only.
Not financial advice. Always do your own research.*
```

---

## 16. Charts and Visualizations

When generating reports in notebook or dashboard contexts (e.g., `scripts/ai_dashboard.py`), the following visualization standards apply:

### 16.1 Standard Chart Types

| Chart | When to Use | Key Requirements |
|-------|------------|-----------------|
| Price chart with MAs | Every deep dive | Show SMA 20, SMA 50, SMA 200 overlaid on daily close |
| Margin trend chart | Financial analysis | 3-5 years of gross, operating, net margins |
| Revenue/earnings bar chart | Growth analysis | Side-by-side bars for revenue and net income, multi-year |
| Peer comparison bar chart | Comparative analysis | Grouped bars for key metrics across peers |
| Risk/return scatter | Portfolio context | X-axis = volatility, Y-axis = return, size = market cap |
| Valuation range chart | Valuation section | Show current price vs. bull/base/bear DCF targets |
| Moat radar/spider chart | Moat analysis | 6-axis radar showing dimension scores |

### 16.2 Chart Formatting Rules

- Title every chart with the metric name and time period
- Label both axes with units
- Use a consistent color palette across all charts in a report
- Include a legend when multiple series are plotted
- Annotate key events (earnings, significant price moves) on price charts
- Export charts as PNG for embedding in markdown via relative paths

---

## 17. Cross-Reference to Other SOPs

| Related SOP | Relationship |
|-------------|-------------|
| SOP-001: Data Collection | Defines data sources and freshness requirements that feed into reports |
| SOP-002: Fundamental Analysis | Detailed methodology for health, growth, and valuation scoring |
| SOP-003: Technical Analysis | Indicator calculations and signal generation logic |
| SOP-004: Valuation | DCF methodology, assumptions, and comparable analysis |
| SOP-005: Risk Assessment | Volatility, VaR, and risk level classification |
| SOP-006: Sentiment Analysis | FinBERT, Reddit, and analyst recommendation aggregation |
| SOP-008: Moat Analysis | Six-dimension moat scoring framework for AI supply chain |

---

## 18. Revision History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | 2026-02-09 | FE-Analyst Research Team | Initial version covering all report types, formatting standards, quality checklist, and AI agent guidelines |

---

*This SOP is maintained in `sops/07_report_writing_and_communication.md` and should be updated whenever report generation logic changes in `src/reports/generator.py` or any of the `scripts/ai_*.py` files.*
